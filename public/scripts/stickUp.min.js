jQuery(function ($) {
    $(document).ready(function () {
        var contentButton = [];
        var contentTop = [];
        var content = [];
        var lastScrollTop = 0;
        var scrollDir = '';
        var itemClass = '';
        var itemHover = '';
        var menuSize = null;
        var stickyHeight = 0;
        var stickyMarginB = 0;
        var currentMarginT = 0;
        var topMargin = 0;

        var url = window.location.href;
        var hashurl = url.split('#')[1];
        //var pos = parseInt($("#" + hashurl).offset().top);
        if (hashurl) {
            window.scrollBy({
                top: 10,
                left: 10,
                behavior: 'smooth'
            });
        }

        $(window).scroll(function (event) {
            var st = $(this).scrollTop();
            if (st > lastScrollTop) {
                scrollDir = 'down';
            } else {
                scrollDir = 'up';
            }
            lastScrollTop = st;
        });
        $.fn.stickUp = function (options) {
            $(this).addClass('stuckMenu');
            var objn = 0;
            if (options != null) {
                for (var o in options.parts) {
                    if (options.parts.hasOwnProperty(o)) {
                        content[objn] = options.parts[objn];
                        objn++;
                    }
                }
                if (objn == 0) {
                    console.log('error:needs arguments');
                }
                itemClass = options.itemClass;
                itemHover = options.itemHover;
                if (options.topMargin != null) {
                    if (options.topMargin == 'auto') {
                        topMargin = parseInt($('.stuckMenu').css('margin-top'));
                    } else {
                        if (isNaN(options.topMargin) && options.topMargin.search("px") > 0) {
                            topMargin = parseInt(options.topMargin.replace("px", ""));
                        } else if (!isNaN(parseInt(options.topMargin))) {
                            topMargin = parseInt(options.topMargin);
                        } else {
                            console.log("incorrect argument, ignored.");
                            topMargin = 0;
                        }
                    }
                } else {
                    topMargin = 0;
                }
                menuSize = $('.' + itemClass).length;
            }
            stickyHeight = parseInt($(this).height());
            stickyMarginB = parseInt($(this).css('margin-bottom'));
            currentMarginT = parseInt($(this).next().closest('div').css('margin-top'));
            vartop = parseInt($(this).offset().top);
        };
        var j = 0;
        var aa = $(window).height() - 100;
        var ab = $('.menuItem:last').not('active').outerHeight();
        var ac = parseInt(aa / ab);
        var ad = $('.menuItem').length;
        var ae = ad - ac;
        var da, dc;
        //console.log(ad, ac)

        $(document).on('scroll', function () {

            varscroll = parseInt($(document).scrollTop());
            if (menuSize != null) {
                for (var i = 0; i < menuSize; i++) {
                    contentTop[i] = $('#' + content[i] + '').offset().top;

                    function bottomView(i) {
                        contentView = $('#' + content[i] + '').height() * .4;
                        testView = contentTop[i] - contentView;
                        if (varscroll > testView) {
                            $('.' + itemClass).removeClass(itemHover);
                            $('.' + itemClass + ':eq(' + i + ')').addClass(itemHover);
                        } else if (varscroll < 50) {
                            $('.' + itemClass).removeClass(itemHover);
                            $('.' + itemClass + ':eq(0)').addClass(itemHover);
                        }
                    }
                    if (scrollDir == 'down' && varscroll > contentTop[i] - 50 && varscroll < contentTop[i] + 50) {
                        $('.' + itemClass).removeClass(itemHover);
                        $('.' + itemClass + ':eq(' + i + ')').addClass(itemHover);

                        if (i <= ae) {
                            //console.log(i, ae);
                            j = i * ab;
                            $(".navbar-nav").css('margin-top', '-' + j + 'px');
                            //console.log('down', i, j);
                        } else {
                            //console.log(2222);
                            j = ae * ab;
                            $(".navbar-nav").css('margin-top', '-' + j + 'px');
                        }
                    }
                    if (scrollDir == 'up' && varscroll > contentTop[i] - 50 && varscroll < contentTop[i] + 50) {
                        da = j;
                        if (i <= ae) {
                            dc = i - 1;
                            j = dc * ab;
                            $(".navbar-nav").css('margin-top', '-' + j + 'px');
                            //console.log('up', i, j)
                        } else {
                            $(".navbar-nav").css('margin-top', '-' + da + 'px');
                            //console.log('--up', i, da)
                        }
                    }
                    if (scrollDir == 'up' && varscroll == 0) {
                        //console.log('top');
                        $(".navbar-nav").css('margin-top', '0px');
                    }
                    if (scrollDir == 'up') {
                        bottomView(i);
                    }
                }
            }
            var ax = vartop - 100;
            var fotrtop = parseInt($('.connect-with').offset().top - $(window).height());

            //console.log(ax, varscroll)
            if (ax < varscroll) {
                $('.stuckMenu').addClass('sticky');
                $('.stuckMenu').removeClass('bottom');
                //$('.navbar-wrapper').css("position", "fixed");
                //$('.stuckMenu').css("top", "100px");

            };
            if (varscroll < ax) {

                $('.stuckMenu').removeClass('sticky');
                $('.stuckMenu').removeClass('bottom');
                $('.stuckMenu').next().closest('div').css({
                    'margin-top': currentMarginT + 'px'
                }, 10);
                //$('.stuckMenu').css("position", "relative");
                //$('.stuckMenu').css("top", "0px");
            };
            if (varscroll > fotrtop) {
                $('.stuckMenu').removeClass('sticky');
                $('.stuckMenu').addClass('bottom');
            }
        });

    });
});
